<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>Hello, world!</title>
    <style>
        .list-group-item .form-check {
            position: relative;
            display: block;
            padding: .5rem 1rem;
            color: #212529;
            text-decoration: none;
            background-color: #fff;
            border-bottom: 1px solid rgba(0, 0, 0, .125);
            border-right: none;
            border-left: none;
            border-top: none;
            cursor: pointer;

        }

        .form-check {
            border-bottom: 1px solid rgba(0, 0, 0, .125);
            border-right: none;
            border-left: none;
            border-top: none;
        }

        .form-check:hover {
            background-color: #f8f9fa;
            /* .t-action style display should be block */
        }

        .body1 {
            display: none;
        }

        #action_button {
            display: none;
        }

        .t-action {
            margin-left: 10px;
            cursor: pointer;
        }
    </style>
</head>















<body>
    <div class="container_body1" style="display: none;">

        <nav class="navbar navbar-expand-lg navbar-light bg-light">


            <div class="container-fluid">
                <form class="d-flex">
                    <input class="form-control me-auto mb-2 mb-lg-0" oninput="onsearchtemplateinput()" type="search"
                        placeholder="Search Template" aria-label="Search">

                </form>

                <button type="button" class="btn  btn-primary active" data-bs-toggle="button" autocomplete="off"
                    aria-pressed="true">Create Template</button>
                <button type="button" class="btn  btn-primary active" data-bs-toggle="button" autocomplete="off"
                    aria-pressed="true" onclick="testbutton()">test button</button>

            </div>
        </nav>
    </div>














    <!-- Body 2 Below  -->


    <div class="container_body2">
        <div class="row">
            <div class="col-md-12" style="margin-left: 15px;">
                <h5>Select Template</h5>
            </div>
            <div>


                <nav class="navbar navbar-expand-lg navbar-light bg-light">


                    <div class="container-fluid">
                        <form class="d-flex">
                            <input class="form-control me-auto mb-2 mb-lg-0" id="search_bal"
                                oninput="onsearchtemplateinput()" type="search" placeholder="Search Template"
                                aria-label="Search">
                            <div class="dropdown" id="action_button">
                                <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton1"
                                    data-bs-toggle="dropdown" aria-expanded="false">
                                    Actions
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                                    <li><a class="dropdown-item" href="#" onclick="delete_templates()">Delete</a></li>
                                    <li><a class="dropdown-item" href="#" id="action_preview"
                                            onclick="previewtemplate()">Preview</a></li>
                                    <li><a class="dropdown-item" href="#" id="action_edit"
                                            onclick="edittemplate()">Edit</a></li>
                                </ul>


                            </div>

                        </form>




                        <button type="button" class="btn  btn-primary active" data-bs-toggle="button"
                            onclick="createtemplate()" autocomplete="off" aria-pressed="true">Create Template</button>

                    </div>
                </nav>
                <div class="container">
                    <div class="list-group" style="margin-top: 30px;">





                    </div>
                    <!-- create button that aligns to the right end -->

                    <div class="d-flex flex-row-reverse bd-highlight ">
                        <button type="button" class="btn btn-primary template_select" data-bs-toggle="button"
                            autocomplete="off" aria-pressed="true" onclick="templateselected()"
                            style="display: none;">select template</button>
                    </div>

                </div>



                <!-- Modal  for Success Delete-->
                <div class="modal fade" id="alertdelete" tabindex="-1" aria-labelledby="alertdelete" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content alertdelete_class">

                        </div>
                    </div>
                </div>




                <!-- modal for template edit and tempate create -->
                <div class="modal fade" id="template_preview" tabindex="-1" aria-labelledby="alertdelete"
                    aria-hidden="true">
                    <div class="modal-dialog">

                        <div class="modal-content template_preview_class">
                            <div class="container" style="margin-top: 10px; margin-bottom: 20px;">
                                <div class="mb-3">
                                    <label for="exampleFormControlInput1" class="form-label">Title</label>
                                    <input type="text" class="form-control" id="exampleFormControlInput1"
                                        placeholder="Your title here">
                                </div>
                                <div class="mb-3">
                                    <label for="exampleFormControlTextarea1" class="form-label">Content</label>
                                    <textarea class="form-control" id="exampleFormControlTextarea1" rows="10"
                                        placeholder="Enter # to insert variables"></textarea>
                                </div>
                                <div class="d-flex justify-content-end">
                                    <btn class="btn btn-primary" onclick="savetemplatetodb()">Save</btn>
                                </div>

                            </div>

                        </div>
                    </div>
                </div>



            </div>

        </div>





        <!-- html for preview   -->
        <div class="container_body3" style="display: none;">
            Kindly Preview your message here
        </div>
















        <!-- JAVASCRTIPTS CODE HERE -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous">
        </script>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>



        <script>
            let action_array = [];
            let selected_template = ""
            let template_update_property = {}
            onsearchtemplateinput()


            function templateselected() {
                alert(selected_template)
            }




            // show template preview
            function previewtemplate() {

                var data = JSON.stringify({
                    "template_name": action_array[0]
                });

                var config = {
                    method: 'post',
                    url: 'http://127.0.0.1:2001/getspecific_template',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    data: data
                };

                axios(config)
                    .then(function (response) {
                        console.log(JSON.stringify(response.data));
                        // append to div with id template_preview
                        var preview_html = `
                     <div class="modal-dialog">
                     <div class="modal-content template_preview_class">
                     <div class="container" style="margin-top: 10px; margin-bottom: 20px;">
                            <div class="mb-3">
                                <label for="exampleFormControlInput1" class="form-label">Title</label>
                                <input type="text" class="form-control" id="exampleFormControlInput1"
                                    value="${response.data.title}" disabled readonly>
                            </div>
                            <div class="mb-3">
                                <label for="exampleFormControlTextarea1" class="form-label">Content</label>
                                <textarea class="form-control" id="exampleFormControlTextarea1" rows="10"
                                    placeholder="Enter # to insert variables" disabled readonly>${response.data.content}</textarea>
                            </div>
                        

                            </div>
                            </div>`
                        $("#template_preview").html(preview_html);
                        $('#template_preview').modal('show')
                    })
                    .catch(function (error) {
                        console.log(error);
                    });

            }




            // Edit template
            function edittemplate() {


                var data = JSON.stringify({
                    "template_name": action_array[0]
                });

                var config = {
                    method: 'post',
                    url: 'http://127.0.0.1:2001/getspecific_template',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    data: data
                };

                axios(config)
                    .then(function (response) {
                        template_update_property['old_title'] = action_array[0]
                        console.log(JSON.stringify(response.data));

                        // append to div with id template_preview
                        var preview_html = `
                     <div class="modal-dialog">
                     <div class="modal-content template_preview_class">
                        <div class="container" style="margin-top: 10px; margin-bottom: 20px;">
                            <div class="mb-3">
                                <label for="exampleFormControlInput1" class="form-label">Title</label>
                                <input type="text" class="form-control" id="exampleFormControlInput1"
                                    placeholder="Your title goes here" value="${response.data.title}">
                            </div>
                            <div class="mb-3">
                                <label for="exampleFormControlTextarea1" class="form-label">Content</label>
                                <textarea class="form-control" id="exampleFormControlTextarea1" rows="10"
                                    placeholder="Enter # to insert variables">${response.data.content}</textarea>
                            </div>
                            <div class="d-flex justify-content-end">
                                <btn class="btn btn-primary" onclick="updatetemplate()">Save</btn>
                            </div>

                            </div>
                            </div>`
                        $("#template_preview").html(preview_html);
                        $('#template_preview').modal('show')


                    })
                    .catch(function (error) {
                        console.log(error);
                    });

            }


            function createtemplate() {
                $('#template_preview').modal('show')
            }

            function savetemplatetodb() {
                var title = $("#exampleFormControlInput1").val()
                var content = $("#exampleFormControlTextarea1").val()


                var data = JSON.stringify({
                    "title": title,
                    "content": content
                });

                var config = {
                    method: 'post',
                    url: 'http://127.0.0.1:2001/createtemplate',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    data: data
                };

                axios(config)
                    .then(function (response) {
                        console.log(JSON.stringify(response.data));
                        alert(response.data)
                        $('#template_preview').modal('hide')
                        onsearchtemplateinput()
                    })
                    .catch(function (error) {
                        console.log(error);
                    });

            }



            function updatetemplate() {
                //    get the value of the title and content
                var title = $("#exampleFormControlInput1").val()
                var content = $("#exampleFormControlTextarea1").val()
                template_update_property['new_title'] = title
                template_update_property['content'] = content



                var data = JSON.stringify(template_update_property);

                var config = {
                    method: 'post',
                    url: 'http://127.0.0.1:2001/update_template',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    data: data
                };

                axios(config)
                    .then(function (response) {
                        console.log(JSON.stringify(response.data));
                        action_array = []
                        alert(response.data)
                        $('#template_preview').modal('hide')
                        onsearchtemplateinput()
                    })
                    .catch(function (error) {
                        console.log(error);
                    });


            }






            function testbutton() {
                console.log(JSON.stringify(action_array))
                alert("You just clicked a test button")



            }


            // function preview() {
            //     // hide body 2
            //     $(".container_body2").hide();
            //     // show body 3
            //     $(".container_body1").show();

            // }







            function delete_templates() {
                // get the length of action_array
                var length_arr_to_bedeleted = action_array.length;

                var data = JSON.stringify(action_array);

                var config = {
                    method: 'post',
                    url: 'http://127.0.0.1:2001/deletetemplate_api',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    data: data
                };

                axios(config)
                    .then(function (response) {
                        console.log(JSON.stringify(response.data));
                        action_array = [];
                        onsearchtemplateinput()
                    })
                    .catch(function (error) {
                        console.log(error);
                    });


                // $(".alertdelete_class").empty();
                // $(".alertdelete_class").append("<div class='modal-header'><h5 class='modal-title' id='alertdelete'>Success</h5><button type='button' class='btn-close' data-bs-dismiss='modal' aria-label='Close'></button></div>");

                // $(".alertdelete_class").append("<div class='modal-body'>All "+length_arr_to_bedeleted+" selected templates deleted successfully.</div>");
                // // add close button
                // $(".alertdelete_class").append("<div class='modal-footer'><button type='button' class='btn btn-secondary' data-bs-dismiss='modal'>Close</button></div>");
                if (length_arr_to_bedeleted > 1) {
                    var header =
                        "<div class='modal-header'><h5 class='modal-title' id='alertdelete'>Success</h5><button type='button' class='btn-close' data-bs-dismiss='modal' aria-label='Close'></button></div>"
                    var body = "<div class='modal-body'>All " + length_arr_to_bedeleted +
                        " selected templates deleted successfully.</div>"
                    var footer =
                        "<div class='modal-footer'><button type='button' class='btn btn-secondary' data-bs-dismiss='modal'>Close</button></div>"
                } else {

                    var header =
                        "<div class='modal-header'><h5 class='modal-title' id='alertdelete'>Success</h5><button type='button' class='btn-close' data-bs-dismiss='modal' aria-label='Close'></button></div>"
                    var body = "<div class='modal-body'>1 template deleted successfully.</div>"
                    var footer =
                        "<div class='modal-footer'><button type='button' class='btn btn-secondary' data-bs-dismiss='modal'>Close</button></div>"
                }


                var modal = header + body + footer;
                $(".alertdelete_class").html(modal);
                // show the modal
                $("#alertdelete").modal("show");

            }


            function addtemplate() {

            }



            function onsearchtemplateinput() {
                // get the 
                var search_value = $("#search_bal").val();

                var data = JSON.stringify({
                    "search_input": search_value
                });

                var config = {
                    method: 'post',
                    url: 'http://127.0.0.1:2001/templates',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    data: data
                };

                axios(config)
                    .then(function (response) {
                        var array = response.data
                        $(".list-group").empty();


                        array.forEach(function (element) {



                            var listGroupItem = document.createElement("div");
                            listGroupItem.className = "form-check";
                            // Add on hover styling

                            listGroupItem.innerHTML = `
                            <input class="form-check-input" type="checkbox" value="${element.title}">
                            <label class="form-check-label" for="${element.content}">
                              ${element.title}
                            </label>
                            `;





                            $(".list-group").append(listGroupItem);
                            // add an event listener to the form-check-input
                            listGroupItem.querySelector('input[type="checkbox"]').addEventListener(
                                'change',
                                function () {

                                    // // get the value of the checkbox
                                    var value = this.checked ? this.value : false;
                                    if (value == false) {
                                        // remove the value from the array
                                        action_array.splice(action_array.indexOf(this.value), 1);
                                    } else {
                                        action_array.push(value)
                                    }
                                    // get the number of values in action_array
                                    action_array_length = action_array.length;

                                    if (action_array_length == 0) {
                                        console.log("empty    ===========")
                                        document.getElementById("action_button").style.display =
                                            "none";
                                        $(".template_select").hide();
                                    } else if (action_array_length == 1) {
                                        document.getElementById("action_button").style.display =
                                            "block";
                                        document.getElementById("action_edit").style.display =
                                            "block";
                                        document.getElementById("action_preview").style.display =
                                            "block";
                                        selected_template = action_array[0];

                                        $(".template_select").show();
                                    } else {
                                        console.log("not empty===========")
                                        console.log(action_array)
                                        document.getElementById("action_edit").style.display =
                                            "none";
                                        document.getElementById("action_button").style.display =
                                            "block";
                                        document.getElementById("action_preview").style.display =
                                            "none";
                                        $(".template_select").hide();
                                    }
                                });

                        });


                    })
                    .catch(function (error) {
                        console.log(error);
                    });

            }
        </script>
</body>

</html>