<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://live.zwidgets.com/js-sdk/1.1/ZohoEmbededAppSDK.min.js"></script>

    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>Hello, world!</title>
    <style>
        .list-group-item .form-check {
            position: relative;
            display: block;
            padding: .5rem 1rem;
            color: #212529;
            text-decoration: none;
            background-color: #fff;
            border-bottom: 1px solid rgba(0, 0, 0, .125);
            border-right: none;
            border-left: none;
            border-top: none;
            cursor: pointer;

        }

        .form-check {
            border-bottom: 1px solid rgba(0, 0, 0, .125);
            border-right: none;
            border-left: none;
            border-top: none;
        }

        .form-check:hover {
            background-color: #f8f9fa;
            /* .t-action style display should be block */
        }

        .body1 {
            display: none;
        }

        #action_button {
            display: none;
        }

        .t-action {
            margin-left: 10px;
            cursor: pointer;
        }

        .wa_things {
            margin-bottom: -30px;
        }

        #variable:hover {
            background-color: #ddd;
        }
    </style>
</head>





<body>
    <div class="container container_body1" style="display: block;">
        <h3>New Whatsapp Message</h3>
        <div class="row wa_things no_of_contacts_here  " style="margin-top: 60px;">
            <div class="col">
                To
            </div>
            <div class="col" id="no_selected_contact">

            </div>

        </div>


        <div class="row wa_things" style="margin-top: 60px;">
            <div class="col">
                Template
            </div>
            <div class="col">
                <div class="row">
                    <div class="col">
                        <button class="btn btn-primary" style="width: 140px;" onclick="body1_template_select()">
                            Select Template
                        </button>
                    </div>
                    <div class="col" id="after_template_selected" style="font-weight: bold; font-size: 15px;">

                    </div>
                </div>


            </div>

        </div>


        <div class="row wa_things" style="margin-top: 60px;">
            <div class="col">
                From
            </div>
            <div class="col wa_account_select">
                <div class="dropdown ">
                    <button class="btn btn-secondary dropdown-toggle this_where_message_willbesent" type="button"
                        id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                        Sales Support
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                        <li><a class="dropdown-item" href="#" onclick="wa_sales()">Sales Support</a></li>
                        <li><a class="dropdown-item" href="#" onclick="wa_customer()">Customer Support</a></li>
                    </ul>
                </div>
            </div>

        </div>



        <div class="row wa_things" style="margin-top: 60px;">
            <div class="col">
                Send Options
            </div>
            <div class="col">

                <div class="form-check" style="border: none;">
                    <input class="form-check-input flexradio_picker" type="radio" name="flexRadioDefault"
                        id="flexRadioDefault1" value="sendnow" checked>
                    <label class="form-check-label" for="flexRadioDefault1">
                        Send Immediately

                    </label>
                </div>


                <div class="form-check" style="border: none;">
                    <input class="form-check-input flexradio_picker" type="radio" name="flexRadioDefault"
                        id="flexRadioDefault2" value="sendlater">
                    <label class="form-check-label" for="flexRadioDefault2">
                        Schedule Later
                    </label>
                    <div class="container" id="date_time_picker"
                        style="margin-top: 20px; display: none; background-color:0 0 1px rgb(0 0 0 / 20%); height: 60px;">
                        <div class="align-self-center">
                            <div class="row">
                                <div class="col">
                                    Date:
                                </div>
                                <div class="col">
                                    Time:
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <input type="date" class="form-control" id="inputdate" placeholder="Select Date">
                            </div>
                            <div class="col">
                                <input type="time" class="form-control" id="inputtime" placeholder="Select Time">
                            </div>
                        </div>
                    </div>

                </div>
                <div class="form-check" style="margin-top: 30px;">
                    Interval Between message: <input type="text" id="time_interval" aria-label="Username" 
                        value="10"> secs
                </div>

            </div>
        </div>



        <div class="container " style="margin-top: 60px;">
            <div class="row wa_things" style="margin-top: 60px;">
                <hr style="height: 5px; ">

            </div>
            <div style="margin-top: 60px; text-align: end;">
                <button class="btn btn-primary" type="button" onclick="send_whatsappmessage()">
                    Send Message
                </button>
            </div>
        </div>


        <!-- Modal  for processing_message Sent -->
        <div class="modal fade" id="processing_message" tabindex="-1" aria-labelledby="alertdelete" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content processing_message">

                </div>
            </div>
        </div>


    </div>













    <!-- Body 2 Below  -->


    <div class="container_body2" style="display: none;">
        <div class="row">
            <div class="col-md-12" style="margin-left: 15px;">
                <h5>Select Template</h5>
            </div>
            <div>


                <nav class="navbar navbar-expand-lg navbar-light bg-light">


                    <div class="container-fluid">
                        <form class="d-flex">
                            <input class="form-control me-auto mb-2 mb-lg-0" id="search_bal"
                                oninput="onsearchtemplateinput()" type="search" placeholder="Search Template"
                                aria-label="Search">
                            <div class="dropdown" id="action_button">
                                <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton1"
                                    data-bs-toggle="dropdown" aria-expanded="false">
                                    Actions
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                                    <li><a class="dropdown-item" href="#" onclick="delete_templates()">Delete</a></li>
                                    <li><a class="dropdown-item" href="#" id="action_preview"
                                            onclick="previewtemplate()">Preview</a></li>
                                    <li><a class="dropdown-item" href="#" id="action_edit"
                                            onclick="edittemplate()">Edit</a></li>
                                </ul>


                            </div>

                        </form>




                        <button type="button" class="btn  btn-primary active" data-bs-toggle="button"
                            onclick="createtemplate()" autocomplete="off" aria-pressed="true">Create Template</button>

                    </div>
                </nav>
                <div class="container">
                    <div class="list-group" style="margin-top: 30px;">





                    </div>
                    <!-- create button that aligns to the right end -->

                    <div class="d-flex flex-row-reverse bd-highlight ">
                        <button type="button" class="btn btn-primary template_select" data-bs-toggle="button"
                            autocomplete="off" aria-pressed="true" onclick="templateselected()"
                            style="display: none;">select template</button>
                    </div>

                </div>



                <!-- Modal  for Success Delete-->
                <div class="modal fade" id="alertdelete" tabindex="-1" aria-labelledby="alertdelete" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content alertdelete_class">

                        </div>
                    </div>
                </div>




                <!-- modal for template edit and tempate create -->
                <div class="modal fade" id="template_preview" tabindex="-1" aria-labelledby="alertdelete"
                    aria-hidden="true">

                </div>



            </div>

        </div>





        <!-- JAVASCRTIPTS CODE HERE -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous">
        </script>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>



        <script>
            let backend_url = "https://1429-102-89-47-109.eu.ngrok.io";
            let action_array = [];
            let selected_template = ""
            let template_update_property = {}
            let moduleName;
            let variables_array;
            let entitydetail;
            let wa_option;
            let sendoption;
            sendoption = "sendnow"
            wa_option = "https://asanafinder.com:2000/sendmessage";

            function variableinsert() {
                if (moduleName == "Contacts" || moduleName == "Course_Detail" || moduleName == "Leads") {
                    variables_array = [{
                        "name": "Name",
                        "value": "{name}"
                    }]
                } else {
                    variables_array = [{
                            "name": "Name",
                            "value": "{name}"
                        }, {
                            "name": "MB_Program_Name",
                            "value": "{MB_Program_Name}"
                        },
                        {
                            "name": "MB_Expiration_Date",
                            "value": "{MB_Expiration_Date}"
                        }
                    ]
                }

                var html_content = `
                <span onclick="document.getElementById('zoho-variables').style.display='none'"
                  class="w3-button w3-display-topright">&times;</span>
                <h4 onclick="zohovariables()">Select Variables</h4>
                <hr>
                
                `


                $("#zohovar-container").html(html_content);
                // loop through array and create a p with the name and value
                for (let i = 0; i < variables_array.length; i++) {
                    let variable = variables_array[i];
                    // create element p
                    let p = document.createElement("p");
                    // add class
                    p.id = "variable";
                    p.style.cursor = "pointer";
                    p.innerHTML = variable.name;


                    // p on click add variabls_array[i]['value'] to the text area with classname editing_area
                    p.onclick = function () {
                        let textarea = document.getElementsByClassName("editingg_area")[0];
                        textarea.value += variable.value;
                    }

                    p.onclick = function () {
                        console.log(variable.value)
                        $(".editing_area").val($(".editing_area").val() + variable.value);
                    }



                    $("#zohovar-container").append(p);
                    $("#zoho-variables").show()
                }


            }





            onsearchtemplateinput()
            // var tttttt = $('.flexradio_picker').val()
            // console.log(tttttt)

            // console.log value of radio picker
            $(".flexradio_picker").change(function () {
                if ($(this).is(":checked")) {
                    sendoption = $(this).val();
                    if ($(this).val() == "sendlater") {
                        $("#date_time_picker").show();
                    } else {
                        $("#date_time_picker").hide();
                    }
                }
            });


            function templateselected() {
                selected_template = action_array[0]
                $("#after_template_selected").html(selected_template);
                $(".container_body2").hide();
                $(".container_body1").show()
            }


            function body1_template_select() {
                $(".container_body1").hide();
                $(".container_body2").show();
            }


            function send_whatsappmessage() {
                var data = {}

                // get the text inside  with html with class name this_where_message_willbesent
                if (selected_template == "") {
                    alert("Please select a template")
                    return
                }

                if (sendoption == "sendlater") {

                    let date = $("#inputdate").val();
                    let time = $("#inputtime").val();
                    let time_interval = $("#time_interval").val();
                    data['date'] = date;
                    data['time'] = time;
                    data['sendoption'] = sendoption;
                    data['wa_option'] = wa_option;
                    data['selected_template'] = selected_template;

                    let datetime = date + " " + time;
                    console.log(datetime)
                    console.log(`sendoption: ${sendoption} , wa_option: ${wa_option}`)
                    console.log(selected_template)
                    data['entitydetail'] = entitydetail
                    data['time_interval'] = time_interval


                    console.log(data)
                } else {
                    // get value for time interval
                    let time_interval = $("#time_interval").val();
                    data['sendoption'] = sendoption;
                    data['wa_option'] = wa_option;
                    data['selected_template'] = selected_template;
                    data['entitydetail'] = entitydetail
                    data['time_interval'] = time_interval;
                    console.log(data)

                }

                var data = JSON.stringify(data);
                var config = {
                    method: 'post',
                    url: `${backend_url}/updated_messagesender`,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    data: data
                };

                var html_content = `<div class="modal-header">
                            <h5 class="modal-title">Status</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <p>Processing..............</p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>`
                
                        $(".processing_message").html(html_content);
                // show the modal
                $("#processing_message").modal("show");

                axios(config)
                    .then(function (response) {
                        console.log(JSON.stringify(response.data));
                        alert(response.data)
                    })
                    .catch(function (error) {
                        console.log(error);
                    });


            }





            function wa_sales() {
                wa_option = "https://asanafinder.com:2000/sendmessage";
                var html_content = `<div class="dropdown">
                    <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                        Sales Support
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                      <li><a class="dropdown-item" href="#" onclick="wa_sales()">Sales Support</a></li>
                      <li><a class="dropdown-item" href="#" onclick="wa_customer()">Customer Support</a></li>
                    </ul>
                  </div>`

                $(".wa_account_select").html(html_content)
            }


            function wa_customer() {
                wa_option = "https://asanafinder.com:8080/sendmessage";
                var html_content = `<div class="dropdown">
                    <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                        Customer Support
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                      <li><a class="dropdown-item" href="#" onclick="wa_sales()">Sales Support</a></li>
                      <li><a class="dropdown-item" href="#" onclick="wa_customer()">Customer Support</a></li>
                    </ul>
                  </div>`

                $(".wa_account_select").html(html_content)
            }




            // show template preview
            function previewtemplate() {

                var data = JSON.stringify({
                    "template_name": action_array[0]
                });

                var config = {
                    method: 'post',
                    url: `${backend_url}/getspecific_template`,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    data: data
                };

                axios(config)
                    .then(function (response) {
                        console.log(JSON.stringify(response.data));
                        // append to div with id template_preview
                        var preview_html = `
                     <div class="modal-dialog">
                     <div class="modal-content template_preview_class">
                     <div class="container" style="margin-top: 10px; margin-bottom: 20px;">
                            <div class="mb-3">
                                <label for="exampleFormControlInput1" class="form-label">Title</label>
                                <input type="text" class="form-control" id="exampleFormControlInput1"
                                    value="${response.data.title}" disabled readonly>
                            </div>
                            <div class="mb-3">
                                <label for="exampleFormControlTextarea1" class="form-label">Content</label>
                                <textarea class="form-control" id="exampleFormControlTextarea1" on rows="10"
                                 disabled readonly>${response.data.content}</textarea>
                            </div>
                        

                            </div>
                            </div>`
                        $("#template_preview").html(preview_html);
                        $('#template_preview').modal('show')
                    })
                    .catch(function (error) {
                        console.log(error);
                    });

            }




            // Edit template
            function edittemplate() {


                var data = JSON.stringify({
                    "template_name": action_array[0]
                });

                var config = {
                    method: 'post',
                    url: `${backend_url}/getspecific_template`,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    data: data
                };

                axios(config)
                    .then(function (response) {
                        template_update_property['old_title'] = action_array[0]
                        console.log(JSON.stringify(response.data));

                        // append to div with id template_preview
                        var preview_html = `
                     <div class="modal-dialog">
                     <div class="modal-content template_preview_class">
                        <div class="container" style="margin-top: 10px; margin-bottom: 20px;">
                            <div class="mb-3">
                                <label for="exampleFormControlInput1" class="form-label">Title</label>
                                <input type="text" class="form-control" id="exampleFormControlInput1"
                                    placeholder="Your title goes here" value="${response.data.title}">
                            </div>
                            <div class="mb-3">
                                <label for="exampleFormControlTextarea1" class="form-label">Content</label>
                                <textarea class="form-control editing_area" id="exampleFormControlTextarea1" rows="10"
                                  ">${response.data.content}</textarea>
                            </div>



                                                            
        <div id="zoho-variables" class="w3-modal">
            <div class="w3-modal-content" style=" max-width: 200px;">
              <div class="w3-container " id="zohovar-container" style="min-height: 100px; max-height: 500px; overflow: scroll;">
                

                
              </div>
            </div>
         </div>



                            <div class="d-flex justify-content-end">
                                    <div class="row">
                                        <div class="col">
                                            <btn class="btn btn-primary" onclick="variableinsert()" style="width: 120px;">Insert Variable</btn>
                                        </div>
                                        <div class="col">
                                            <btn class="btn btn-primary" onclick="updatetemplate()">Save</btn>
                                        </div>
                                    </div>
                                    
                                </div>


                            </div>
                            </div>`
                        $("#template_preview").html(preview_html);
                        $('#template_preview').modal('show')
                        action_array = []

                    })
                    .catch(function (error) {
                        console.log(error);
                    });

            }


            function createtemplate() {
                // 
                var html_t = `<div class="modal-dialog">

                        <div class="modal-content template_preview_class">
                            <div class="container" style="margin-top: 10px; margin-bottom: 20px;">
                                <div class="mb-3">
                                    <label for="exampleFormControlInput1" class="form-label">Title</label>
                                    <input type="text" class="form-control" id="exampleFormControlInput1"
                                        placeholder="Your title here">
                                </div>
                                <div class="mb-3">
                                    <label for="exampleFormControlTextarea1" class="form-label">Content</label>
                                    <textarea class="form-control editing_area" id="exampleFormControlTextarea1" rows="10"
                                      "></textarea>
                                </div>


                                
        <div id="zoho-variables" class="w3-modal">
            <div class="w3-modal-content" style=" max-width: 200px;">
              <div class="w3-container " id="zohovar-container" style="min-height: 100px; max-height: 500px; overflow: scroll;">
                

                
              </div>
            </div>
         </div>



                                <div class="d-flex justify-content-end">
                                    <div class="row">
                                        <div class="col">
                                            <btn class="btn btn-primary" onclick="variableinsert()" style="width: 120px;">Insert Variable</btn>
                                        </div>
                                        <div class="col">
                                            <btn class="btn btn-primary" onclick="savetemplatetodb()">Save</btn>
                                        </div>
                                    </div>
                                    
                                </div>

                        
                            </div>

                        </div>
                        </div>`
                $("#template_preview").html(html_t);

                $('#template_preview').modal('show')
            }

            function savetemplatetodb() {
                var title = $("#exampleFormControlInput1").val()
                var content = $("#exampleFormControlTextarea1").val()


                if (title == '' || content == '') {
                    alert('Please fill all the fields')
                } else {

                    var data = JSON.stringify({
                        "title": title,
                        "content": content
                    });

                    var config = {
                        method: 'post',
                        url: `${backend_url}/createtemplate`,
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        data: data
                    };

                    axios(config)
                        .then(function (response) {
                            console.log(JSON.stringify(response.data));
                            alert(response.data)
                            $('#template_preview').modal('hide')
                            onsearchtemplateinput()
                        })
                        .catch(function (error) {
                            console.log(error);
                        });

                }

            }




            function updatetemplate() {
                //    get the value of the title and content
                var title = $("#exampleFormControlInput1").val()
                var content = $("#exampleFormControlTextarea1").val()
                template_update_property['new_title'] = title
                template_update_property['content'] = content



                var data = JSON.stringify(template_update_property);

                var config = {
                    method: 'post',
                    url: `${backend_url}/update_template`,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    data: data
                };

                axios(config)
                    .then(function (response) {
                        console.log(JSON.stringify(response.data));
                        action_array = []
                        alert(response.data)
                        $('#template_preview').modal('hide')
                        onsearchtemplateinput()
                    })
                    .catch(function (error) {
                        console.log(error);
                    });

            }






            function testbutton() {
                console.log(JSON.stringify(action_array))
                alert("You just clicked a test button")



            }


            // function preview() {
            //     // hide body 2
            //     $(".container_body2").hide();
            //     // show body 3
            //     $(".container_body1").show();

            // }







            function delete_templates() {
                // get the length of action_array
                var length_arr_to_bedeleted = action_array.length;

                var data = JSON.stringify(action_array);

                var config = {
                    method: 'post',
                    url: `${backend_url}/deletetemplate_api`,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    data: data
                };

                axios(config)
                    .then(function (response) {
                        console.log(JSON.stringify(response.data));
                        action_array = [];
                        onsearchtemplateinput()
                    })
                    .catch(function (error) {
                        console.log(error);
                    });


                // $(".alertdelete_class").empty();
                // $(".alertdelete_class").append("<div class='modal-header'><h5 class='modal-title' id='alertdelete'>Success</h5><button type='button' class='btn-close' data-bs-dismiss='modal' aria-label='Close'></button></div>");

                // $(".alertdelete_class").append("<div class='modal-body'>All "+length_arr_to_bedeleted+" selected templates deleted successfully.</div>");
                // // add close button
                // $(".alertdelete_class").append("<div class='modal-footer'><button type='button' class='btn btn-secondary' data-bs-dismiss='modal'>Close</button></div>");
                if (length_arr_to_bedeleted > 1) {
                    var header =
                        "<div class='modal-header'><h5 class='modal-title' id='alertdelete'>Success</h5><button type='button' class='btn-close' data-bs-dismiss='modal' aria-label='Close'></button></div>"
                    var body = "<div class='modal-body'>All " + length_arr_to_bedeleted +
                        " selected templates deleted successfully.</div>"
                    var footer =
                        "<div class='modal-footer'><button type='button' class='btn btn-secondary' data-bs-dismiss='modal'>Close</button></div>"
                } else {

                    var header =
                        "<div class='modal-header'><h5 class='modal-title' id='alertdelete'>Success</h5><button type='button' class='btn-close' data-bs-dismiss='modal' aria-label='Close'></button></div>"
                    var body = "<div class='modal-body'>1 template deleted successfully.</div>"
                    var footer =
                        "<div class='modal-footer'><button type='button' class='btn btn-secondary' data-bs-dismiss='modal'>Close</button></div>"
                }


                var modal = header + body + footer;
                $(".alertdelete_class").html(modal);
                // show the modal
                $("#alertdelete").modal("show");

            }


            function addtemplate() {

            }

            $(function () {
                var dtToday = new Date();

                var month = dtToday.getMonth() + 1;
                var day = dtToday.getDate();
                var year = dtToday.getFullYear();
                if (month < 10)
                    month = '0' + month.toString();
                if (day < 10)
                    day = '0' + day.toString();
                var maxDate = year + '-' + month + '-' + day;
                $('#inputdate').attr('min', maxDate);
            });

            // prefill date with today's date and the time to 10 mins later
            $(function () {
                var dtToday = new Date();
                var month = dtToday.getMonth() + 1;
                var day = dtToday.getDate();
                var year = dtToday.getFullYear();
                if (month < 10)
                    month = '0' + month.toString();
                if (day < 10)
                    day = '0' + day.toString();
                var maxDate = year + '-' + month + '-' + day;
                $('#inputdate').val('min', maxDate);

                $('#inputdate').val(maxDate);
                var time = dtToday.getHours();


                console.log(time)
                if (time < 10)
                    time = '0' + time.toString();
                var time_str = time + ":59";
                $('#inputtime').val(time_str);
            });



            function onsearchtemplateinput() {
                // get the 
                var search_value = $("#search_bal").val();

                var data = JSON.stringify({
                    "search_input": search_value
                });

                var config = {
                    method: 'post',
                    url: `${backend_url}/templates`,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    data: data
                };

                axios(config)
                    .then(function (response) {
                        var array = response.data
                        $(".list-group").empty();


                        array.forEach(function (element) {


                            var listGroupItem = document.createElement("div");
                            listGroupItem.className = "form-check";
                            // Add on hover styling

                            listGroupItem.innerHTML = `
                            <input class="form-check-input" type="checkbox" value="${element.title}">
                            <label class="form-check-label" for="${element.content}">
                              ${element.title}
                            </label>
                            `;





                            $(".list-group").append(listGroupItem);
                            // add an event listener to the form-check-input
                            listGroupItem.querySelector('input[type="checkbox"]').addEventListener(
                                'change',
                                function () {

                                    // // get the value of the checkbox
                                    var value = this.checked ? this.value : false;
                                    if (value == false) {
                                        // remove the value from the array
                                        action_array.splice(action_array.indexOf(this.value), 1);
                                    } else {
                                        action_array.push(value)
                                    }
                                    // get the number of values in action_array
                                    action_array_length = action_array.length;

                                    if (action_array_length == 0) {
                                        console.log("empty    ===========")
                                        document.getElementById("action_button").style.display =
                                            "none";
                                        $(".template_select").hide();
                                    } else if (action_array_length == 1) {
                                        document.getElementById("action_button").style.display =
                                            "block";
                                        document.getElementById("action_edit").style.display =
                                            "block";
                                        document.getElementById("action_preview").style.display =
                                            "block";
                                        selected_template = action_array[0];

                                        $(".template_select").show();
                                    } else {
                                        console.log("not empty===========")
                                        console.log(action_array)
                                        document.getElementById("action_edit").style.display =
                                            "none";
                                        document.getElementById("action_button").style.display =
                                            "block";
                                        document.getElementById("action_preview").style.display =
                                            "none";
                                        $(".template_select").hide();
                                    }
                                });

                        });


                    })
                    .catch(function (error) {
                        console.log(error);
                    });





                ZOHO.embeddedApp.on("PageLoad", function (data) {
                    console.log(JSON.stringify(data));
                    moduleName = data.Entity
                    console.log("Page Loaded with data");

                    console.log(data.EntityId)

                    const userids = data.EntityId 
                    // html of col with id 'no_selected_contact' 
                    var content = `${data.EntityId.length} Selected ${data.Entity}`;
                    $("#no_selected_contact").html(content)

                    entitydetail = data
                });


                ZOHO.embeddedApp.init()

            }
        </script>
</body>

</html>
